<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QueueFlow - Modern Queue Management</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}" />
    <style>
      .admin-header {
        background: linear-gradient(45deg, #dc2626, #ef4444);
      }
      .logo-icon {
        background: linear-gradient(45deg, #dc2626, #ef4444);
      }
      .logo-text {
        background: linear-gradient(45deg, #dc2626, #ef4444);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
    </style>
  </head>
  <body style="background: #ffffffb6 !important;">
    <div class="header">
      <div class="logo">
        <div class="logo-icon">Q</div>
        <div class="logo-text">QueueFlow</div>
      </div>
      <div class="subtitle">Modern Queue Management System</div>
      <div class="queue-selector">
        <div class="queue-type active" data-type="general">General Queue</div>
        <div class="queue-type" data-type="priority">Priority Queue</div>
      </div>
    </div>

    <div class="controls">
      <div class="control-buttons">
        <form method="post" action="#" style="display: inline">
          <button type="submit" class="btn btn-primary">⏭️ Next</button>
        </form>
        <form method="post" action="#" style="display: inline">
          <button type="submit" class="btn btn-secondary">📢 Call Again</button>
        </form>
        <form method="post" action="#" style="display: inline">
          <button type="submit" class="btn btn-secondary">⏭️ Skip</button>
        </form>
        <form method="post" action="#" style="display: inline">
          <button
            type="submit"
            class="btn btn-danger"
            onclick="return confirm('Are you sure?')"
          >
            🔄 Reset
          </button>
        </form>
      </div>

      <div class="queue-settings">
        <div class="settings-title">Queue Settings</div>
        <form method="post" action="#">
          <div class="setting-item">
            <div class="setting-label">Queue Prefix</div>
            <input
              type="text"
              name="queue_prefix"
              value="A"
              class="setting-value"
              maxlength="1"
            />
          </div>
          <div class="setting-item">
            <div class="setting-label">Auto Advance</div>
            <input
              type="checkbox"
              name="auto_advance"
              checked
              class="setting-value"
            />
          </div>
          <div class="setting-item">
            <div class="setting-label">Sound Alerts</div>
            <input type="checkbox" name="sound_enabled" class="setting-value" />
          </div>
          <button
            type="submit"
            class="btn btn-primary"
            style="margin-top: 15px; width: 100%"
          >
            💾 Save Settings
          </button>
        </form>
      </div>
    </div>

    <div class="container" style="margin-top: 50px">
      <div class="header">
        <div class="admin-header" style="background: #ffffffb6;">
          <div class="logo">
            <div class="logo-icon">A</div>
            <div>
              <div class="logo-text">QueueFlow Admin</div>
              <div style="font-size: 16px; color: #64748b; margin-top: 5px">
                Queue Management System - Admin Panel
              </div>
            </div>
          </div>
          <div class="admin-badge">Administrator Panel</div>
        </div>
      </div>

      <div class="main-grid">
        <div class="queue-management">
          <div class="section-title">📋 Queue Overview</div>
          <div class="queue-grid" id="queueGrid">
            <div class="queue-item waiting" onclick="openQueueModal('1')">
              <div class="queue-number">A002</div>
              <div class="queue-status">Waiting</div>
              <div class="queue-time">5m est.</div>
            </div>
            <div class="queue-item pending" onclick="openQueueModal('2')">
              <div class="pending-badge">!</div>
              <div class="queue-number">A003</div>
              <div class="queue-status">Pending</div>
              <div class="queue-time">8m est.</div>
            </div>
            <div class="no-queues" style="display: none">
              No queues available
            </div>
          </div>

          <div class="section-title">⚙️ Queue Actions</div>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 15px;
            "
          >
            <form method="post" action="#" style="display: inline">
              <button type="submit" class="btn btn-primary">
                ⏭️ Call Next
              </button>
            </form>
            <form method="post" action="#" style="display: inline">
              <button type="submit" class="btn btn-success">
                ✅ Mark Completed
              </button>
            </form>
            <form method="post" action="#" style="display: inline">
              <button type="submit" class="btn btn-warning">
                ⏸️ Mark Pending
              </button>
            </form>
            <form method="post" action="#" style="display: inline">
              <button type="submit" class="btn btn-danger">
                ⏭️ Skip Current
              </button>
            </form>
          </div>
        </div>

        <div class="controls-panel">
          <div class="section-title">📊 Statistics</div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value">50</div>
              <div class="stat-label">Total Queues</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">40</div>
              <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">3</div>
              <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">7m</div>
              <div class="stat-label">Avg Time</div>
            </div>
          </div>

          <div class="pending-queue">
            <div class="pending-title">⏳ Pending Queues</div>
            <div class="pending-list">
              <form method="post" action="#" style="display: inline">
                <button type="submit" class="pending-item">A003</button>
              </form>
              <form method="post" action="#" style="display: inline">
                <button type="submit" class="pending-item">A005</button>
              </form>
            </div>
          </div>

          <div class="time-estimate">
            <div
              class="section-title"
              style="font-size: 18px; margin-bottom: 15px"
            >
              ⏰ Time Settings
            </div>
            <form method="post" action="#">
              <div class="form-group">
                <label class="form-label">Default Service Time (minutes)</label>
                <input
                  type="number"
                  name="default_time"
                  class="form-input"
                  value="10"
                  min="1"
                  max="120"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Current Queue Estimate</label>
                <input
                  type="number"
                  name="current_estimate"
                  class="form-input"
                  value="5"
                  min="1"
                  max="120"
                />
              </div>
              <button type="submit" class="btn btn-primary">
                💾 Update Estimates
              </button>
            </form>
          </div>

          <div class="quick-actions">
            <div
              class="section-title"
              style="font-size: 18px; margin-bottom: 15px"
            >
              🚀 Quick Actions
            </div>
            <form method="post" action="#" style="margin-bottom: 10px">
              <button type="submit" class="btn btn-primary">
                ➕ Add New Queue
              </button>
            </form>
            <form method="post" action="#" style="margin-bottom: 10px">
              <button
                type="submit"
                class="btn btn-warning"
                onclick="return confirm('Reset all pending queues?')"
              >
                🔄 Reset Pending
              </button>
            </form>
            <form method="post" action="#">
              <button
                type="submit"
                class="btn btn-danger"
                onclick="return confirm('Reset entire system? This cannot be undone!')"
              >
                🗑️ Reset System
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="queueModal">
      <div class="modal-content">
        <div class="modal-header">Queue Details</div>
        <form id="queueDetailsForm" method="post" action="#">
          <input type="hidden" name="queue_id" id="modalQueueId" />

          <div class="form-group">
            <label class="form-label">Queue Number</label>
            <input
              type="text"
              class="form-input"
              id="modalQueueNumber"
              readonly
            />
          </div>

          <div class="form-group">
            <label class="form-label">Estimated Time (minutes)</label>
            <input
              type="number"
              name="estimated_time"
              class="form-input"
              id="modalEstimateTime"
              min="1"
              max="120"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Status</label>
            <select name="status" class="form-input" id="modalStatus">
              <option value="waiting">Waiting</option>
              <option value="current">Current</option>
              <option value="completed">Completed</option>
              <option value="pending">Pending</option>
              <option value="skipped">Skipped</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Notes</label>
            <textarea
              name="notes"
              class="form-input"
              id="modalNotes"
              rows="3"
              placeholder="Add notes..."
            ></textarea>
          </div>

          <div class="modal-buttons">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal()"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal" id="queueModal">
      <div class="modal-content">
        <div class="modal-header">Queue Details</div>
        <form id="queueDetailsForm" method="post" action="#">
          <input type="hidden" name="queue_id" id="modalQueueId" />

          <div class="form-group">
            <label class="form-label">Queue Number</label>
            <input
              type="text"
              class="form-input"
              id="modalQueueNumber"
              readonly
            />
          </div>

          <div class="form-group">
            <label class="form-label">Estimated Time (minutes)</label>
            <input
              type="number"
              name="estimated_time"
              class="form-input"
              id="modalEstimateTime"
              min="1"
              max="120"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Status</label>
            <select name="status" class="form-input" id="modalStatus">
              <option value="waiting">Waiting</option>
              <option value="current">Current</option>
              <option value="completed">Completed</option>
              <option value="pending">Pending</option>
              <option value="skipped">Skipped</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Notes</label>
            <textarea
              name="notes"
              class="form-input"
              id="modalNotes"
              rows="3"
              placeholder="Add notes..."
            ></textarea>
          </div>

          <div class="modal-buttons">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal()"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Auto-refresh for public display every 30 seconds
      setTimeout(function () {
        // For a static page, this reloads the entire page. In a dynamic Django app, you'd fetch updated data.
        // location.reload();
      }, 30000);

      // Queue type selector (simplified for static HTML)
      document.querySelectorAll(".queue-type").forEach((type) => {
        type.addEventListener("click", function () {
          // In a static HTML, this would just change the active class.
          // In Django, this would trigger a new request with the selected queue type.
          document
            .querySelectorAll(".queue-type")
            .forEach((t) => t.classList.remove("active"));
          this.classList.add("active");
          console.log("Selected queue type:", this.dataset.type);
        });
      });

      // Queue modal functions (simplified data for static HTML)
      function openQueueModal(queueId) {
        // In a real Django app, you would fetch data from an API endpoint using `fetch()`
        // For this static version, we'll simulate some data
        const queueDetails = {
          1: {
            id: "1",
            number: "A002",
            estimated_time: 5,
            status: "waiting",
            notes: "Walk-in customer",
          },
          2: {
            id: "2",
            number: "A003",
            estimated_time: 8,
            status: "pending",
            notes: "Requires manager approval",
          },
        };

        const data = queueDetails[queueId];

        if (data) {
          document.getElementById("modalQueueId").value = data.id;
          document.getElementById("modalQueueNumber").value = data.number;
          document.getElementById("modalEstimateTime").value =
            data.estimated_time;
          document.getElementById("modalStatus").value = data.status;
          document.getElementById("modalNotes").value = data.notes || "";

          document.getElementById("queueModal").classList.add("active");
        } else {
          alert("Queue details not found for ID: " + queueId);
        }
      }

      function closeModal() {
        document.getElementById("queueModal").classList.remove("active");
      }

      // Auto-refresh admin panel every 15 seconds (simplified for static HTML)
      setTimeout(function () {
        // location.reload();
      }, 15000);

      // Handle modal click outside to close
      document
        .getElementById("queueModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeModal();
          }
        });
    </script>
  </body>
</html>
